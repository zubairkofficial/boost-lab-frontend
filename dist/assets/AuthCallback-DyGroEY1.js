import{u as h,a as g,r as f,j as _}from"./index-l2lJbs6z.js";import{s as d}from"./supabaseClient-Ch2ViwFy.js";function x(){const e=h(),{setUser:i,setUserId:c}=g();return f.useEffect(()=>{(async()=>{try{const t=new URLSearchParams(window.location.hash.substring(1)),o=t.get("access_token"),a=t.get("refresh_token");if(!o||!a){console.error("No tokens found in callback URL"),e("/auth/login");return}const{data:l,error:u}=await d.auth.setSession({access_token:o,refresh_token:a});if(u||!l.session){console.error("Auth error:",u?.message),e("/auth/login");return}const n=l.session.user,{data:s,error:m}=await d.from("users").select("id, name, email, stripe_customer_id").eq("auth_uid",n.id).single();if(m||!s){console.error("Failed to fetch user from DB:",m?.message),e("/auth/login");return}const r={userId:s.id,name:s.name||n.user_metadata?.full_name||n.email,email:s.email,stripe_customer_id:s.stripe_customer_id,role:"user"};console.log("User logged in:",r),i?.(r),c?.(r.userId),localStorage.setItem("user",JSON.stringify(r)),localStorage.setItem("access_token",o),localStorage.setItem("refresh_token",a),localStorage.setItem("user_id",r.userId.toString()),e("/personal-account")}catch(t){console.error("Unexpected error:",t),e("/auth/login")}})()},[e,i,c]),_.jsx("p",{className:"text-white text-center",children:"Finishing loginâ€¦"})}export{x as default};
