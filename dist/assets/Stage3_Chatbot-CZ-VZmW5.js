import{r as a,u as S,j as e,O as F,X as A,o as u,w as x}from"./index-l2lJbs6z.js";import{M as k,r as C,b as R,a as D,S as E}from"./index-5PsVmsv8.js";function z(){const y=localStorage.getItem("user"),r=JSON.parse(y??"{}")?.userId,[m,i]=a.useState([]),[l,h]=a.useState(""),[o,g]=a.useState(!1),[c,w]=a.useState(null),[j,v]=a.useState(!1),p=S(),d=a.useRef(null),f=a.useRef(null);a.useEffect(()=>{f.current?.focus()},[]),a.useEffect(()=>{d.current?.scrollTo({top:d.current.scrollHeight,behavior:"smooth"})},[m]),a.useEffect(()=>{if(!r)return;(async()=>{try{const s=await u.get(`https://app.boostlab.ph/api/v1/agent/strategy/${r}`,{withCredentials:!0});if(!s.data.success||!s.data.strategy){x.error("Stage 2 strategy not found. Complete Stage 2 first.");return}w(s.data.strategy);const n=await u.get(`https://app.boostlab.ph/api/v1/stage3/${r}/history`,{withCredentials:!0});n.data.success&&Array.isArray(n.data.history)&&(n.data.history.length>0?i(n.data.history):i([{sender:"bot",message:`Hi, I’m Boostie. You’ve already completed your marketing strategy. Now let’s bring it to life through content. 

 Should we proceed ? `,createdAt:new Date().toISOString()}]))}catch(s){console.error(s),x.error("Failed to fetch Stage 2 strategy or Stage 3 history")}})()},[r]);const b=async()=>{if(!l.trim()||!r||!c)return;const t={sender:"user",message:l,createdAt:new Date().toISOString()};i(s=>[...s,t]),h(""),g(!0);try{const s=await u.post(`https://app.boostlab.ph/api/v1/stage3/${r}/chat`,{message:l},{withCredentials:!0}),n=s.data.botReply;i(N=>[...N,{sender:"bot",message:s.data.botReply,createdAt:new Date().toISOString()}]),n.includes("That’s what we’ll do in Stage 4")&&v(!0)}catch(s){x.error(s?.response?.data?.message||"Something went wrong")}finally{g(!1)}};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center text-white overflow-auto before:absolute before:inset-0 before:bg-[#2A4C57]/95 before:z-0",style:{backgroundImage:"url(https://static.tildacdn.net/tild6534-6232-4333-a431-313138303165/bg_1_1.jpg)",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},children:[e.jsx(F,{position:"top-right"}),e.jsxs("div",{className:"w-full max-w-4xl h-full flex flex-col relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between py-4 border-b border-[#87F1FF]/30 bg-[#2A4C57]/60 backdrop-blur-md",children:[e.jsxs("div",{className:"px-6",children:[e.jsx("h1",{className:"text-lg font-semibold text-white",children:"Stage 3: Content & Branding"}),e.jsx("p",{className:"text-sm text-white",children:"Content & Branding Execution"})]}),e.jsx("button",{onClick:()=>p(-1),className:"p-2 rounded-lg transition-colors cursor-pointer",children:e.jsx(A,{className:"w-8 h-8 text-[#87F1FF]"})})]}),e.jsx("div",{ref:d,className:"flex-1 overflow-y-scroll hide-scrollbar bg-transparent",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-6 space-y-6",children:[m.map((t,s)=>e.jsx("div",{className:"group",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-[#537F89]/70 flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-medium text-white",children:t.sender==="user"?"U":"AI"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-[#87F1FF] mb-1",children:t.sender==="user"?"You":"Boostie"}),e.jsx("div",{className:"prose max-w-none text-white leading-relaxed",children:t.sender==="user"?e.jsx("p",{className:"whitespace-pre-wrap",children:t.message}):e.jsx(k,{remarkPlugins:[D],rehypePlugins:[C,R],children:t.message})}),t.createdAt&&e.jsx("div",{className:"text-xs text-gray-400 mt-2",children:new Date(t.createdAt).toLocaleTimeString()})]})]})},s)),j&&e.jsx("div",{className:"text-center mt-4",children:e.jsx("button",{onClick:()=>p("/automation"),className:"px-4 py-2 bg-[#98EBA5] text-[#2A4C57] rounded-lg font-semibold cursor-pointer",children:"Start Stage 4"})}),o&&e.jsx("div",{className:"group",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-[#537F89]/70 flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-medium text-white",children:"B"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-[#87F1FF] mb-1",children:"Boostie"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-[#98EBA5] rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-[#98EBA5] rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-2 h-2 bg-[#98EBA5] rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})]})]})})]})}),e.jsx("div",{className:"border-[#87F1FF]/30 bg-[#2A4C57]/60 backdrop-blur-md p-4",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsx("div",{className:"relative flex items-end gap-3",children:e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("textarea",{ref:f,value:l,onChange:t=>h(t.target.value),placeholder:"Type your message...",className:"w-full px-4 py-3 pr-12 border border-[#87F1FF]/40 rounded-xl bg-[#537F89]/30 focus:outline-none resize-none text-white placeholder-gray-300",rows:1,readOnly:o||!c,onKeyDown:t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),b())},style:{minHeight:"48px",maxHeight:"120px"}}),e.jsx("button",{onClick:b,className:"absolute right-2 bottom-3 p-2 bg-[#98EBA5] text-[#2A4C57] rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-colors",disabled:o||!l.trim()||!c,children:e.jsx(E,{className:"w-4 h-4 text-center"})})]})})})})]})]})}export{z as default};
