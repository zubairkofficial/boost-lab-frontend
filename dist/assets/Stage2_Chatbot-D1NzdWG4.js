import{m as D,r as a,u as M,j as e,O as P,X as R,o as f,w as u}from"./index-PEltmJuc.js";import{M as $,r as H,a as k,b as O,S as T}from"./index-CTL9PrZg.js";function _(){const F=D(t=>t.user.user),C=localStorage.getItem("user"),p=JSON.parse(C??"{}"),i=p?.userId,l=F?.email||p?.email,[b,c]=a.useState([]),[o,y]=a.useState(""),[d,w]=a.useState(!1),[r,A]=a.useState(2),[B,E]=a.useState(!1),[j,I]=a.useState(null),v=M(),m=a.useRef(null),x=a.useRef(null);a.useEffect(()=>{x.current?.focus()},[]),a.useEffect(()=>{d||x.current?.focus()},[d]),a.useEffect(()=>{m.current?.scrollTo({top:m.current.scrollHeight,behavior:"smooth"})},[b]),a.useEffect(()=>{if(r===2&&!l||r===3&&!i)return;(async()=>{try{const s=r===2?`https://app.boostlab.ph/api/v1/agent/chat/${l}`:`https://app.boostlab.ph/api/v1/stage3/${i}/history`,n=await f.get(s,{withCredentials:!0});c(n.data.history||[])}catch{u.error("Failed to load chat history")}})()},[l,i,r]);const N=async()=>{if(!o.trim())return;if(r===2&&!l){u.error("Email not found. Please log in again.");return}if(r===3&&!i){u.error("User not found. Please log in again.");return}const t={sender:"user",message:o,createdAt:new Date().toISOString()};c(s=>[...s,t]),y(""),w(!0);try{if(r===2){const n=(await f.post("https://app.boostlab.ph/api/v1/agent/strategy",{email:l,audit_answers:[o]},{withCredentials:!0})).data.strategy;I(n),n.includes("Stage 3: Content & Branding")&&E(!0),S(n)}else if(r===3){const s=await f.post(`https://app.boostlab.ph/api/v1/stage3/${i}/chat`,{message:o,strategy:j},{withCredentials:!0});S(s.data.botReply)}}catch(s){u.error(s?.response?.data?.message||"Something went wrong")}finally{w(!1)}},S=async t=>{const s=t.split(`

`).filter(Boolean),n={sender:"bot",message:"",createdAt:new Date().toISOString()};c(g=>[...g,n]);for(const g of s)n.message+=g+`

`,c(h=>[...h.slice(0,-1),n]),await new Promise(h=>setTimeout(h,150))};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center text-white overflow-auto before:absolute before:inset-0 before:bg-[#2A4C57]/95 before:z-0",style:{backgroundImage:"url(https://static.tildacdn.net/tild6534-6232-4333-a431-313138303165/bg_1_1.jpg)",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},children:[e.jsx(P,{position:"top-right"}),e.jsxs("div",{className:"w-full max-w-4xl h-full flex flex-col relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between py-4 border-b border-[#87F1FF]/30 bg-[#2A4C57]/60 backdrop-blur-md",children:[e.jsxs("div",{className:"px-6",children:[e.jsx("h1",{className:"text-lg font-semibold text-white",children:r===2?"Stage 2: Marketing Strategy":"Stage 3: Content & Branding"}),e.jsx("p",{className:"text-sm text-white",children:r===2?"Professional Strategy Development":"Content & Branding Execution"})]}),e.jsx("button",{onClick:()=>v(-1),className:"p-2 rounded-lg transition-colors cursor-pointer",children:e.jsx(R,{className:"w-6 h-6 text-[#87F1FF]"})})]}),e.jsxs("div",{ref:m,className:"flex-1 overflow-y-scroll hide-scrollbar bg-transparent",children:[e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-6 space-y-6",children:[b.map((t,s)=>e.jsx("div",{className:"group",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-[#537F89]/70 flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-medium text-white",children:t.sender==="user"?"U":"AI"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-[#87F1FF] mb-1",children:t.sender==="user"?"You":"Boostie"}),e.jsx("div",{className:"prose max-w-none text-white leading-relaxed",children:t.sender==="user"?e.jsx("p",{className:"whitespace-pre-wrap",children:t.message}):e.jsx($,{remarkPlugins:[k],rehypePlugins:[H,k,O],children:t.message})}),t.createdAt&&e.jsx("div",{className:"text-xs text-gray-400 mt-2",children:new Date(t.createdAt).toLocaleTimeString()})]})]})},s)),d&&e.jsx("div",{className:"group",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-[#537F89]/70 flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-medium text-white",children:"B"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-[#87F1FF] mb-1",children:"Boostie"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-[#98EBA5] rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-[#98EBA5] rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-2 h-2 bg-[#98EBA5] rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})]})]})})]}),B&&r===2&&e.jsx("div",{className:"text-center mt-4",children:e.jsx("button",{onClick:()=>{A(3),c([{sender:"bot",message:`Here is your Stage 2 marketing strategy:

${j}`,createdAt:new Date().toISOString()},{sender:"bot",message:`Hi, I’m Boostie — your personal AI mentor inside the BoostLab platform. You’ve completed your marketing strategy.

Could you please confirm the first marketing channel listed in your 'Channels and Traffic Paths' that you'd like to start working on?`,createdAt:new Date().toISOString()}]),v("/content")},className:"px-4 py-2 bg-[#98EBA5] text-[#2A4C57] rounded-lg font-semibold cursor-pointer",children:"Start Stage 3"})})]}),e.jsx("div",{className:" border-[#87F1FF]/30 bg-[#2A4C57]/60 backdrop-blur-md p-4",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsx("div",{className:"relative flex items-end gap-3",children:e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("textarea",{ref:x,value:o,onChange:t=>y(t.target.value),placeholder:"Type your message...",className:"w-full px-4 py-3 pr-12 border border-[#87F1FF]/40 rounded-xl bg-[#537F89]/30 focus:outline-none resize-none text-white placeholder-gray-300",rows:1,disabled:d,onKeyDown:t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),N())},style:{minHeight:"48px",maxHeight:"120px"}}),e.jsx("button",{onClick:N,className:"absolute right-2 bottom-3 p-2 bg-[#98EBA5] text-[#2A4C57] rounded-lg  disabled:opacity-50 disabled:cursor-not-allowed transition-colors",disabled:d||!o.trim(),children:e.jsx(T,{className:"w-4 h-4 text-center"})})]})})})})]})]})}export{_ as default};
